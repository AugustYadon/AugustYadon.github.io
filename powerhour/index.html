<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Auggo's Power Hour</title>

    <!-- bootstrap.min.css -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/styles.css" rel="stylesheet">

    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->



  </head>

  <body>
    <div style="border-radius: 0px; ;background: rgb(32, 33, 35); border: none;" class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
<!-- ko if: isLoggedIn --><a class="navbar-brand" href="https://en.wikipedia.org/wiki/Power_hour"><span style="color: white; font-family:'Oswald'; font-size: 1.6em">Drink on brother</span></a>            <!-- /ko -->
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <!-- ko ifnot: isLoggedIn -->
              <li class="active">
                <div id="login" style="max-height: 50px;">
                  <div data-bind="if: loginErrorMessage">
                    <div class="alert alert-danger" data-bind="text: loginErrorMessage"></div>
                  </div>
                  <button id="login-button" style="color: white; background: transparent;border: none; margin-top: 15px; font-family:'Oswald'" class="btn btn-primary" data-bind="click: login">Log in via Spotify</button>
                </div>
              </li>
            <!-- /ko -->
            <!-- ko if: isLoggedIn -->
              <li class="active">
                <div id="loggedin">
                  <div data-bind="with: user">
                    <div>
                      <img style="padding-top: 2px; max-height: 50px; clip-path: circle(23px at center); " data-bind="attr: {src: images[0].url}">
                      <img id="profileswoop" style="margin-bottom: -54px; margin-left: -50px; position: absolute; filter: brightness(125%);" src="/img/swoopyarrow.jpg">      
                      <div id="profilename" style="margin-bottom: -82px; margin-left: -170px;position: absolute; padding-top: 15px;  font-size:1.5em;font-family:'Oswald'"><span data-bind="text: display_name"></span></div>
                    </div>
                  </div>
                </div>
              </li>
              <li class="active">
                <div id="loggedin" style="max-height: 50px;">
                  <button id="login-button" style="color: white; background: transparent;border: none; margin-top: 15px; font-family:'Oswald'" data-bind="click: logout">Log out</button>
                </div>
              </li>
            <!-- /ko -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
      <!-- ko ifnot: isLoggedIn -->
      <br><br><br><br><br><br><br><br>      <br><br><br><br><br><br><br><br>
      <p style="font-size:1.4em; font-family:'Oswald'">Beer has always, since the dawn of time, been man's primary source of sustenance. Alongside every magnificent triumph, and through every great struggle, man has endured with a frosty lite pilsner in hand. For this, among many other reasons, I say: <br>
        <div style="color: rgb(51, 210, 99);font-size:1.6em;"><b> Drink on brother.</b></div></p>
      <p style="font-size:2em; font-family:'Oswald'"> -Sir David Attenborough</p>
      <!-- <img src="/img/steelbarrels.jpg" style="max-width: 120%; height: auto; position: sticky; bottom: 0px; "> -->
      <!-- /ko -->

      <!-- ko if: isLoggedIn -->
        <div id="loggedin">
        <br />
        <br />
<!--           <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104)" type="button" value="skiptotwenty" onclick="skiptotwenty();">
          <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104)" type="button" value="get_info" onclick="getinfo();">
          <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104)" type="button" value="log info" onclick="loginfo();"> -->
         
         <!-- SETTINGS -->
        <div>
          <div style="background-color:rgb(32, 33, 35); font-family:'Oswald'; height: 30px"><span style="position:relative; color:white; font-family:'Oswald'; font-size: 1.6em">Settings</span></div>


          <!--SLIDER -->
          <div class="slidecontainer">
            <span style="color:rgb(32, 33, 35); font-family:'Oswald'; font-size: 1.6em">Beep volume</span>
            <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
          </div>
          <hr>
        </div>

         <!-- CONTROLS -->
         <div>
          <div style="background-color:rgb(32, 33, 35); font-family:'Oswald'; height: 30px"><span style="position:relative; color:white; font-family:'Oswald'; font-size: 1.6em">Controls</span></div>
          <br>
          <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104);" type="button" value="Begin Power Hour" onclick="beginPowerHour();">
          <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104)" type="button" value="Pause" onclick="pausePowerHour();">
          <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104)" type="button" value="End" onclick="stopPowerHour();">
        </div>
        <hr>
        <!-- Playlists -->
        <h2>My playlists</h2>
        <ul style="background: radial-gradient(rgba(32, 33, 35,0.4), rgba(0,0,0,0) 70%);" data-bind="foreach: playlists">
          <li class="media playlist">
            <div class="media-left">
              <img data-bind="attr: {src: images.length ? images[0].url : ''}" width="200" height="200" />
            </div>
            <div class="media-body">
              <div class="media-heading" data-bind="text:name"></div>
              <input class="btn btn-primary" style="background-color: rgb(51, 210, 99); border-color: rgb(40, 200, 104);" type="button" value="Playlist Power Hour" onclick="beginPowerHour('spotify:track:1qV7xk7miGq7WaZzdaF2U9');">

            </div>
          </li>
        </ul>

      </div>
      <!-- /ko -->
    </div>

    <!-- jQuery required for Bootstrap core JavaScript -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <!-- This file would be available as a vendor dependency in your local project if you're using Bower or Composer -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/knockout/dist/knockout.js"></script>
    <script src="bower_components/spotify-web-api-js/src/spotify-web-api.js"></script>
    <script src="js/oauth-config.js"></script>
    <script src="js/oauth-manager.js"></script>
    <audio id="audio" src="http://www.soundjay.com/button/beep-07.wav" autoplay="false" ></audio>
  
    <script>
    function playSound() {
          var sound = document.getElementById("audio");
          sound.play();
      }
    </script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
      var player;
      window.onSpotifyWebPlaybackSDKReady = () => {
        var tok = localStorage.getItem('sp-access-token');
        player = new Spotify.Player({
          name: 'Web Playback SDK Quick Start Player',
          getOAuthToken: cb => { cb(tok); }
        });

        // Error handling
        player.addListener('initialization_error', ({ message }) => { console.error(message); });
        player.addListener('authentication_error', ({ message }) => { console.error(message); });
        player.addListener('account_error', ({ message }) => { console.error(message); });
        player.addListener('playback_error', ({ message }) => { console.error(message); });

        // Playback status updates
        player.addListener('player_state_changed', state => { console.log(state); });

        // Ready
        player.addListener('ready', ({ device_id }) => {
          console.log('Ready with Device ID', device_id);
        });

        // Not Ready
        player.addListener('not_ready', ({ device_id }) => {
          console.log('Device ID has gone offline', device_id);
        });

        // Connect to the player!
        player.connect();


        // play({
        //   playerInstance: player,
        //   spotify_uri: 'spotify:track:1qV7xk7miGq7WaZzdaF2U9',
        // });

      };





      const play = ({
        spotify_uri,
        playerInstance: {
          _options: {
            getOAuthToken
          }
        }
      }) => {
        getOAuthToken(access_token => {
          fetch('https://api.spotify.com/v1/me/player/play', {
            method: 'PUT',
            body: JSON.stringify({ uris: [spotify_uri] }),
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${access_token}`
            },
          });
        });
      };

      function getOAuthToken(){return localStorage.getItem('sp-access-token');}




      var pausednow = false;
      function pausebutton(){
        pausednow = !pausednow;
        if(pausednow){
          player.pause().then(() => {
            console.log('Resumed!');
          });
        }
        else{ 
          player.resume().then(() => {
            console.log('Resumed!');
          });
        }
      } 

      function SkipToNextSong(){
        var tok = localStorage.getItem('sp-access-token');
        fetch("https://api.spotify.com/v1/me/player/next", {
          method: 'POST',
          headers: {Authorization: 'Bearer '+tok}
        });
      }



      function skiptotwenty(){
        var tok = localStorage.getItem('sp-access-token');
        fetch("https://api.spotify.com/v1/me/player/seek?position_ms=25000", {
          method: 'PUT',
          'Accept': 'application/json',
          headers: {'Content-Type': 'application/json',
          Authorization: 'Bearer '+tok}
        });
      }
      var current_info;

      function getinfo(){
        var tok = localStorage.getItem('sp-access-token');
          fetch("https://api.spotify.com/v1/me/player", {
            method: 'GET',
            'Accept': 'application/json',
            headers: {'Content-Type': 'application/json',
            Authorization: 'Bearer '+tok}
          }).then(response => response.json())
            .then(data => { current_info = data;
          });
      }

      function loginfo(){console.log(current_info)}

      var skipper;

      function beginPowerHour(spotify_uris)
      {
        var counter = 0;
        playSound();
        SkipToNextSong(); 

        skipper = setInterval(function(){ 
          counter++;
          if (counter >= 60){clearInterval(skipper);}
          SkipToNextSong(); 
          playSound();
        }, 60000);
        
        // play({
        //   playerInstance: player,
        //   spotify_uri: spotify_uris,
        // });
      }

      function pausePowerHour(){
        clearInterval(skipper);
      }

      function stopPowerHour(){
        clearInterval(skipper);
      }


    </script>

    <script src="js/spotify-player.js"></script>
  </body>
</html>
